<!DOCTYPE html>
<html lang="en" data-card-theme="classic">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Dungeon Floor Card Crawler</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš”ï¸</text></svg>">
</head>
<body>
  <div id="app">
    <header class="top-bar">
      <div class="logo">
        <span class="title">Dungeon Floor</span>
        <span class="subtitle">Card Crawler</span>
      </div>
      <div class="health-block">
        <div class="health-label">Health</div>
        <div class="health-bar-container">
          <div class="health-bar" id="healthBar"></div>
          <div class="health-value" id="healthValue">20 / 20</div>
        </div>
        <div class="floor-value">Floor <span id="floorValue">1</span></div>
      </div>
      <div class="game-controls">
        <button id="undoButton" class="control-btn undo-btn">Undo</button>
        <button id="restartButton" class="control-btn restart-btn">Restart Game</button>
        <button id="newGameButton" class="control-btn new-game-btn">New Game</button>
        <button id="settingsButton" class="control-btn settings-btn">âš™ï¸ Settings</button>
        <div class="leaderboard-dropdown">
          <button id="leaderboardButton" class="control-btn leaderboard-btn">ğŸ† Leaderboard</button>
        </div>
      </div>
    </header>

    <div class="discard-corner">
      <div class="pile discard-pile">
        <div class="pile-title">Discard</div>
        <div id="discardSlot"></div>
        <div class="pile-count" id="discardCount">0</div>
      </div>
    </div>

    <main>
      <section class="action-row">
        <div class="action-slot">
          <div class="action-label">Take Damage</div>
          <div class="health-drop drop-target" data-drop="health">Drop monsters here</div>
        </div>
        <div class="action-slot">
          <div class="action-label">Heal</div>
          <div class="heal-drop drop-target" data-drop="heal">Drop hearts here</div>
        </div>
        <div class="action-slot">
          <button id="runButton" class="run-btn">Run away (once)</button>
          <div class="run-hint">Use only at start of a floor.</div>
        </div>
      </section>

      <section class="play-area">
        <div class="pile">
          <div class="pile-title">Deck</div>
          <div class="card back" id="deckBack"></div>
          <div class="pile-count" id="deckCount">0</div>
        </div>
        <div class="floor-area">
          <div class="floor-label">Dungeon Floor</div>
          <div class="floor-row" id="floorRow"></div>
        </div>
      </section>

      <section class="equipment-area">
        <div id="weaponInfoBar" class="weapon-info-bar"></div>
        <div class="equipment-slots">
          <div class="slot">
            <div class="slot-title">Equipped weapon</div>
            <div id="weaponSlot" class="drop-target" data-drop="weapon"></div>
            <button id="discardWeaponBtn" class="small-btn">Discard weapon</button>
          </div>
          <div class="slot">
            <div class="slot-title">Weapon damage</div>
            <div id="weaponDamageSlot"></div>
          </div>
        </div>
      </section>
    </main>

    <footer class="status-bar">
      <div id="status"></div>
    </footer>

    <div id="animationOverlay"></div>

    <!-- Win Modal -->
    <div id="winModal" class="game-modal">
      <div class="modal-content win-content">
        <div class="celebration">
          <div class="streamer streamer-1"></div>
          <div class="streamer streamer-2"></div>
          <div class="streamer streamer-3"></div>
          <div class="streamer streamer-4"></div>
          <div class="streamer streamer-5"></div>
          <div class="streamer streamer-6"></div>
          <div class="streamer streamer-7"></div>
          <div class="streamer streamer-8"></div>
        </div>
        <h2 class="modal-title win-title">ğŸ‰ You Win! ğŸ‰</h2>
        <p class="modal-message">You cleared the dungeon!</p>
        <div class="modal-buttons">
          <button id="winNewGameBtn" class="control-btn new-game-btn">New Game</button>
        </div>
      </div>
    </div>

    <!-- Lose Modal -->
    <div id="loseModal" class="game-modal">
      <div class="modal-content lose-content">
        <h2 class="modal-title lose-title">ğŸ’€ You Lose ğŸ’€</h2>
        <p class="modal-message">You have been defeated!</p>
        <div class="modal-buttons">
          <button id="loseRedoBtn" class="control-btn undo-btn">Redo Last Turn</button>
          <button id="loseRestartBtn" class="control-btn restart-btn">Restart Game</button>
          <button id="loseNewGameBtn" class="control-btn new-game-btn">New Game</button>
        </div>
      </div>
    </div>

    <!-- Run Away Popup -->
    <div id="runAwayPopup" class="run-away-popup">
      <div class="popup-content">
        <h3>ğŸƒ Running Away!</h3>
        <p>New floor incoming...</p>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="game-modal">
      <div class="modal-content settings-content">
        <h2 class="modal-title">âš™ï¸ Game Settings</h2>
        
        <div class="settings-section">
          <h3>Quick Difficulty</h3>
          <div class="preset-buttons">
            <button data-preset="brutal" class="preset-btn brutal">Brutal (0.25%)</button>
            <button data-preset="hard" class="preset-btn hard">Hard (~2%)</button>
            <button data-preset="normal" class="preset-btn normal">Normal (~10%)</button>
            <button data-preset="easy" class="preset-btn easy">Easy (~40%)</button>
            <button data-preset="casual" class="preset-btn casual">Casual (~80%)</button>
          </div>
        </div>

        <div class="settings-section">
          <h3>Card Theme</h3>
          <div class="theme-selector" id="themeSelector">
            <div class="theme-option active" data-theme="classic">
              <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 1px solid #2d3748;">âš”ï¸</div>
              <span>Classic</span>
            </div>
            <div class="theme-option" data-theme="dragon">
              <div class="theme-preview" style="background: linear-gradient(135deg, #2d1b1b, #1a0a0a); border: 1px solid #5c2323;">ğŸ‰</div>
              <span>Dragon</span>
            </div>
            <div class="theme-option" data-theme="mystic">
              <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a3e, #0a0a1e); border: 1px solid #3d3d8c;">ğŸ”®</div>
              <span>Mystic</span>
            </div>
            <div class="theme-option" data-theme="nature">
              <div class="theme-preview" style="background: linear-gradient(135deg, #1a2e1a, #0a1e0a); border: 1px solid #2d5c2d;">ğŸŒ¿</div>
              <span>Nature</span>
            </div>
            <div class="theme-option" data-theme="royal">
              <div class="theme-preview" style="background: linear-gradient(135deg, #2e2a1a, #1e1a0a); border: 1px solid #8b7355;">ğŸ‘‘</div>
              <span>Royal</span>
            </div>
            <div class="theme-option" data-theme="skull">
              <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a1a, #0a0a0a); border: 1px solid #404040;">ğŸ’€</div>
              <span>Skull</span>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Custom Settings</h3>
          
          <div class="setting-row">
            <label for="settingMaxHealth">Starting Health:</label>
            <select id="settingMaxHealth">
              <option value="15">15 (Very Hard)</option>
              <option value="20">20 (Default)</option>
              <option value="25">25</option>
              <option value="30">30</option>
              <option value="35">35</option>
              <option value="40">40 (Easy)</option>
            </select>
          </div>

          <div class="setting-row">
            <label for="settingWeaponDegradation">Weapon Degradation:</label>
            <select id="settingWeaponDegradation">
              <option value="strict">Strict (must be less than last)</option>
              <option value="equal">Equal (can be equal or less)</option>
              <option value="none">None (no degradation)</option>
            </select>
          </div>

          <div class="setting-row">
            <label for="settingMaxRuns">Run Away Uses:</label>
            <select id="settingMaxRuns">
              <option value="0">0 (No running)</option>
              <option value="1">1 (Default)</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="999">Unlimited</option>
            </select>
          </div>

          <div class="setting-row">
            <label for="settingHealingMode">Healing Per Floor:</label>
            <select id="settingHealingMode">
              <option value="once">Once (Default)</option>
              <option value="unlimited">Unlimited</option>
            </select>
          </div>

          <div class="setting-row checkbox-row">
            <label>
              <input type="checkbox" id="settingDiamondRoyals">
              Add Diamond J/Q/K as weapons (11-13 power)
            </label>
          </div>

          <div class="setting-row checkbox-row">
            <label>
              <input type="checkbox" id="settingHeartRoyals">
              Add Heart J/Q/K as healing (11-13 heal)
            </label>
          </div>

          <div class="setting-row checkbox-row">
            <label>
              <input type="checkbox" id="settingRemoveAces">
              Remove Ace monsters (no 14-power monsters)
            </label>
          </div>
        </div>

        <div class="modal-buttons">
          <button id="closeSettingsBtn" class="control-btn">Cancel</button>
          <button id="applySettingsBtn" class="control-btn new-game-btn">Apply & New Game</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaderboard Panel (outside #app to avoid backdrop-filter stacking issues) -->
  <div id="leaderboardPanel" class="leaderboard-panel">
    <div class="leaderboard-header">
      <div class="leaderboard-title-row">
        <h3>ğŸ† Global Leaderboard</h3>
        <span id="syncStatus" class="sync-status"></span>
      </div>
      <div class="player-input">
        <input type="text" id="playerNameInput" placeholder="Your name..." maxlength="20" />
        <button id="setPlayerBtn" class="small-btn">Set</button>
        <button id="refreshLeaderboardBtn" class="small-btn refresh-btn" title="Refresh">â†»</button>
      </div>
      <div class="current-player" id="currentPlayerDisplay"></div>
    </div>
    <div class="leaderboard-list" id="leaderboardList">
      <div class="no-players">Loading...</div>
    </div>
  </div>

  <script type="module" src="main.js"></script>
</body>
</html>

